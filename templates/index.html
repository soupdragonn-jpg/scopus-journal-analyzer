<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scopus Journal Readiness Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 15px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-analyze {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-analyze:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner-border {
            color: #667eea;
        }
        
        .results-section {
            display: none;
            margin-top: 30px;
        }
        
        .score-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #667eea;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: white;
            margin: 0 auto 20px;
        }
        
        .score-high { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        .score-medium { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .score-low { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .score-very-low { background: linear-gradient(45deg, #8e44ad, #9b59b6); }
        
        .readiness-level {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .criteria-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .criteria-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .criteria-score {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .recommendations {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .recommendations h5 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .recommendations ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .recommendations li {
            margin-bottom: 8px;
            color: #34495e;
        }
        
        .journal-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-item {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .info-value {
            color: #34495e;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <div class="header">
                <h1><i class="fas fa-microscope"></i> Scopus Journal Readiness Analyzer</h1>
                <p>Анализирайте готовността на научно списание за индексиране в Scopus</p>
            </div>
            
            <div class="input-section">
                <form id="analysisForm">
                    <div class="mb-3">
                        <label for="journalUrl" class="form-label">
                            <i class="fas fa-link"></i> URL на научното списание
                        </label>
                        <input type="url" class="form-control" id="journalUrl" 
                               placeholder="https://example.com/journal" required>
                        <div class="form-text">
                            Въведете URL адреса на списанието, което искате да анализирате
                        </div>
                    </div>
                    <button type="submit" class="btn btn-analyze" id="analyzeBtn">
                        <i class="fas fa-search"></i> Анализирай списанието
                    </button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Зареждане...</span>
                    </div>
                    <p class="mt-2">Анализиране на списанието... Моля изчакайте.</p>
                </div>
            </div>
            
            <div class="results-section" id="resultsSection">
                <div class="row">
                    <div class="col-md-6">
                        <div class="score-card">
                            <div class="readiness-level" id="readinessLevel"></div>
                            <div class="score-circle" id="scoreCircle">
                                <span id="totalScore">0</span>%
                            </div>
                            <div class="text-center">
                                <h5>Обща оценка за Scopus</h5>
                                <p class="text-muted">Готовност за индексиране</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="journal-info" id="journalInfo">
                            <h5><i class="fas fa-info-circle"></i> Информация за списанието</h5>
                            <div id="journalDetails"></div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h5><i class="fas fa-chart-bar"></i> Детайлна оценка по критерии</h5>
                    <canvas id="criteriaChart" width="400" height="200"></canvas>
                </div>
                
                <div class="criteria-grid" id="criteriaGrid">
                    <!-- Критериите ще се генерират динамично -->
                </div>
                
                <div class="recommendations" id="recommendations">
                    <h5><i class="fas fa-lightbulb"></i> Препоръки за подобрение</h5>
                    <ul id="recommendationsList"></ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let criteriaChart = null;
        
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const url = document.getElementById('journalUrl').value;
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const resultsSection = document.getElementById('resultsSection');
            
            // Показваме loading
            analyzeBtn.disabled = true;
            loading.style.display = 'block';
            resultsSection.style.display = 'none';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayResults(data);
                } else {
                    showError(data.error || 'Възникна грешка при анализа');
                }
            } catch (error) {
                showError('Възникна грешка при свързването със сървъра: ' + error.message);
            } finally {
                analyzeBtn.disabled = false;
                loading.style.display = 'none';
            }
        });
        
        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const journalData = data.journal_data;
            const readinessAnalysis = data.readiness_analysis;
            
            // Показваме резултатите
            resultsSection.style.display = 'block';
            
            // Обща оценка
            const totalScore = readinessAnalysis.total_score;
            const readinessLevel = readinessAnalysis.readiness_level;
            
            document.getElementById('totalScore').textContent = Math.round(totalScore);
            document.getElementById('readinessLevel').textContent = readinessLevel;
            
            // Цветово кодиране на оценката
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.className = 'score-circle';
            if (totalScore >= 80) {
                scoreCircle.classList.add('score-high');
            } else if (totalScore >= 60) {
                scoreCircle.classList.add('score-medium');
            } else if (totalScore >= 40) {
                scoreCircle.classList.add('score-low');
            } else {
                scoreCircle.classList.add('score-very-low');
            }
            
            // Информация за списанието
            displayJournalInfo(journalData);
            
            // Детайлна оценка
            displayDetailedScores(readinessAnalysis.detailed_scores);
            
            // Препоръки
            displayRecommendations(readinessAnalysis.recommendations);
            
            // Графика
            createCriteriaChart(readinessAnalysis.detailed_scores);
        }
        
        function displayJournalInfo(journalData) {
            const journalDetails = document.getElementById('journalDetails');
            
            const infoItems = [
                { label: 'Заглавие', value: journalData.title || 'Не е намерено' },
                { label: 'ISSN', value: journalData.issn || 'Не е намерено' },
                { label: 'DOI Prefix', value: journalData.doi_prefix || 'Не е намерено' },
                { label: 'Open Access', value: journalData.open_access ? 'Да' : 'Не' },
                { label: 'Езици', value: journalData.languages.length > 0 ? journalData.languages.join(', ') : 'Не е намерено' },
                { label: 'Честота на публикуване', value: journalData.publication_frequency || 'Не е намерено' },
                { label: 'Редакционен съвет', value: journalData.editorial_board.length + ' членове' }
            ];
            
            journalDetails.innerHTML = infoItems.map(item => `
                <div class="info-item">
                    <span class="info-label">${item.label}:</span>
                    <span class="info-value">${item.value}</span>
                </div>
            `).join('');
        }
        
        function displayDetailedScores(scores) {
            const criteriaGrid = document.getElementById('criteriaGrid');
            
            const criteriaLabels = {
                'content_quality': 'Качество на съдържанието',
                'editorial_standards': 'Редакционни стандарти',
                'peer_review_process': 'Peer Review процес',
                'international_scope': 'Международен обхват',
                'technical_standards': 'Технически стандарти',
                'accessibility': 'Достъпност'
            };
            
            criteriaGrid.innerHTML = Object.entries(scores).map(([key, score]) => `
                <div class="criteria-card">
                    <div class="criteria-title">${criteriaLabels[key] || key}</div>
                    <div class="criteria-score">${Math.round(score)}%</div>
                    <div class="progress mt-2">
                        <div class="progress-bar" style="width: ${score}%"></div>
                    </div>
                </div>
            `).join('');
        }
        
        function displayRecommendations(recommendations) {
            const recommendationsList = document.getElementById('recommendationsList');
            
            if (recommendations.length === 0) {
                recommendationsList.innerHTML = '<li>Списанието отговаря на всички основни критерии за Scopus!</li>';
            } else {
                recommendationsList.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            }
        }
        
        function createCriteriaChart(scores) {
            const ctx = document.getElementById('criteriaChart').getContext('2d');
            
            if (criteriaChart) {
                criteriaChart.destroy();
            }
            
            const criteriaLabels = {
                'content_quality': 'Качество на съдържанието',
                'editorial_standards': 'Редакционни стандарти',
                'peer_review_process': 'Peer Review процес',
                'international_scope': 'Международен обхват',
                'technical_standards': 'Технически стандарти',
                'accessibility': 'Достъпност'
            };
            
            const labels = Object.keys(scores).map(key => criteriaLabels[key] || key);
            const values = Object.values(scores);
            
            criteriaChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Оценка (%)',
                        data: values,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function showError(message) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Грешка:</strong> ${message}
                </div>
            `;
            resultsSection.style.display = 'block';
        }
    </script>
</body>
</html>
